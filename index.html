<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026 Campaign Calendar</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --surface: #161922;
    --border: #252a35;
    --text: #e8eaf0;
    --muted: #5a6070;
    --accent: #f0c040;

    --phase-planning: #4a9eff;
    --phase-execution: #b36fff;
    --phase-launch: #40d9a0;
    --phase-review: #ff7c5c;
    --phase-done: #3a4050;

    --timeline-h: 56px;
    --dot-r: 7px;
    --font-mono: 'DM Mono', monospace;
    --font-display: 'DM Serif Display', serif;
    --font-ui: 'Syne', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-ui);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── TOKEN MODAL ─────────────────────────────── */
  #modal-overlay {
    position: fixed; inset: 0; z-index: 999;
    background: rgba(0,0,0,.85);
    backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
  }
  #modal-overlay.hidden { display: none; }

  .modal-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 48px 48px 40px;
    width: min(480px, 90vw);
    position: relative;
    box-shadow: 0 40px 120px rgba(0,0,0,.6);
  }
  .modal-box::before {
    content: '';
    position: absolute; top: 0; left: 40px; right: 40px; height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    border-radius: 99px;
  }
  .modal-eyebrow {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: .12em;
    color: var(--accent);
    text-transform: uppercase;
    margin-bottom: 12px;
  }
  .modal-title {
    font-family: var(--font-display);
    font-size: 28px;
    line-height: 1.2;
    margin-bottom: 8px;
  }
  .modal-sub {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 28px;
  }
  .modal-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 13px 16px;
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 13px;
    outline: none;
    transition: border-color .2s;
    margin-bottom: 16px;
  }
  .modal-input:focus { border-color: var(--accent); }
  .modal-input::placeholder { color: var(--muted); }
  .modal-btn {
    width: 100%;
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 8px;
    padding: 14px;
    font-family: var(--font-ui);
    font-weight: 700;
    font-size: 14px;
    letter-spacing: .04em;
    cursor: pointer;
    transition: opacity .15s, transform .1s;
  }
  .modal-btn:hover { opacity: .88; }
  .modal-btn:active { transform: scale(.98); }
  .modal-err {
    font-size: 12px;
    color: var(--phase-review);
    margin-top: 10px;
    min-height: 18px;
    font-family: var(--font-mono);
  }

  /* ── HEADER ──────────────────────────────────── */
  header {
    padding: 36px 48px 24px;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    gap: 24px;
    flex-wrap: wrap;
  }
  .header-left h1 {
    font-family: var(--font-display);
    font-size: 36px;
    line-height: 1;
    letter-spacing: -.02em;
  }
  .header-left h1 span { color: var(--accent); font-style: italic; }
  .header-sub {
    font-size: 12px;
    color: var(--muted);
    margin-top: 6px;
    font-family: var(--font-mono);
    letter-spacing: .05em;
  }
  .header-legend {
    display: flex;
    gap: 18px;
    flex-wrap: wrap;
    align-items: center;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: 12px;
    color: var(--muted);
    font-family: var(--font-mono);
    letter-spacing: .03em;
  }
  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* ── CONTROLS ────────────────────────────────── */
  .controls {
    padding: 18px 48px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
    border-bottom: 1px solid var(--border);
  }
  .filter-label {
    font-size: 11px;
    color: var(--muted);
    font-family: var(--font-mono);
    letter-spacing: .08em;
    text-transform: uppercase;
    margin-right: 4px;
  }
  .filter-btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 12px;
    padding: 6px 13px;
    cursor: pointer;
    transition: all .15s;
    letter-spacing: .03em;
  }
  .filter-btn:hover { border-color: var(--accent); color: var(--text); }
  .filter-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(240,192,64,.08); }
  .spacer { flex: 1; }
  #refresh-btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 12px;
    padding: 6px 13px;
    cursor: pointer;
    transition: all .15s;
    display: flex; align-items: center; gap: 6px;
  }
  #refresh-btn:hover { border-color: var(--text); color: var(--text); }
  #status-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--muted);
    display: inline-block;
    transition: background .3s;
  }
  #status-dot.live { background: var(--phase-launch); box-shadow: 0 0 6px var(--phase-launch); }
  #status-dot.loading { background: var(--accent); animation: pulse 1s infinite; }
  #status-dot.error { background: var(--phase-review); }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

  /* ── MAIN TIMELINE ───────────────────────────── */
  main {
    padding: 0 0 80px;
    opacity: 0;
    transition: opacity .4s;
  }
  main.visible { opacity: 1; }

  /* Month header row */
  .month-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    display: flex;
  }
  .month-label-spacer {
    flex-shrink: 0;
    width: 220px;
    border-right: 1px solid var(--border);
  }
  .month-track {
    flex: 1;
    display: flex;
    position: relative;
    overflow: hidden;
  }
  .month-cell {
    position: absolute;
    top: 0; bottom: 0;
    display: flex;
    align-items: center;
    padding-left: 10px;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--muted);
    letter-spacing: .06em;
    text-transform: uppercase;
    border-left: 1px solid var(--border);
  }

  /* Campaign rows */
  .campaign-group { border-bottom: 1px solid var(--border); }
  .campaign-name-bar {
    display: flex;
    align-items: stretch;
  }
  .campaign-label {
    flex-shrink: 0;
    width: 220px;
    padding: 14px 20px;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 4px;
  }
  .campaign-title {
    font-size: 13px;
    font-weight: 700;
    letter-spacing: .02em;
    line-height: 1.2;
  }
  .campaign-meta {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--muted);
    letter-spacing: .04em;
  }
  .campaign-timeline {
    flex: 1;
    position: relative;
    min-height: var(--timeline-h);
  }

  /* Phase lanes inside the timeline */
  .phase-row {
    display: flex;
    align-items: stretch;
    min-height: 44px;
    position: relative;
  }
  .phase-row-label {
    flex-shrink: 0;
    width: 0; /* hidden, info in tooltip */
  }
  .phase-lane {
    flex: 1;
    position: relative;
    border-bottom: 1px solid rgba(255,255,255,.03);
  }
  .phase-lane:last-child { border-bottom: none; }

  /* Grid lines in timeline */
  .month-line {
    position: absolute;
    top: 0; bottom: 0;
    width: 1px;
    background: var(--border);
    pointer-events: none;
  }
  .today-line {
    position: absolute;
    top: 0; bottom: 0;
    width: 2px;
    background: var(--accent);
    opacity: .5;
    pointer-events: none;
  }
  .today-label {
    position: absolute;
    top: 4px;
    transform: translateX(-50%);
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--accent);
    letter-spacing: .06em;
    white-space: nowrap;
    pointer-events: none;
  }

  /* Milestone bar (spanning start→end) */
  .ms-bar {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    height: 6px;
    border-radius: 3px;
    opacity: .25;
    pointer-events: none;
  }

  /* Milestone dot */
  .ms-dot {
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    width: calc(var(--dot-r) * 2);
    height: calc(var(--dot-r) * 2);
    border-radius: 50%;
    cursor: pointer;
    transition: transform .15s, box-shadow .15s;
    z-index: 2;
    border: 2px solid var(--bg);
  }
  .ms-dot:hover {
    transform: translate(-50%, -50%) scale(1.5);
    z-index: 20;
  }
  .ms-dot.done { opacity: .4; }

  /* Tooltip */
  .tooltip {
    position: fixed;
    z-index: 100;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 16px;
    pointer-events: none;
    opacity: 0;
    transition: opacity .12s;
    max-width: 280px;
    box-shadow: 0 16px 48px rgba(0,0,0,.6);
  }
  .tooltip.visible { opacity: 1; }
  .tt-phase {
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: .08em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .tt-name {
    font-size: 14px;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 6px;
  }
  .tt-dates {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .tt-status {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: .06em;
  }
  .tt-status .dot { width: 6px; height: 6px; border-radius: 50%; }

  /* Skeleton / loader */
  .skeleton-msg {
    padding: 80px 48px;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 14px;
    color: var(--muted);
    letter-spacing: .06em;
  }

  /* Scrollable wrapper */
  .scroll-wrapper {
    overflow-x: auto;
    overflow-y: visible;
  }
  .timeline-inner {
    min-width: 900px;
  }

  /* Month header row height */
  .month-header { height: 36px; }

  @media (max-width: 700px) {
    header { padding: 24px 20px 16px; }
    .controls { padding: 12px 20px; }
    .campaign-label { width: 140px; font-size: 11px; }
    .month-label-spacer { width: 140px; }
  }
</style>
</head>
<body>

<!-- TOKEN MODAL -->
<div id="modal-overlay">
  <div class="modal-box">
    <div class="modal-eyebrow">2026 Campaign Calendar</div>
    <h2 class="modal-title">Enter your<br><em>Airtable token</em></h2>
    <p class="modal-sub">Your token stays in this browser session only — it's never sent anywhere except directly to Airtable's API.</p>
    <input class="modal-input" id="token-input" type="password"
           placeholder="pat2Cx…" autocomplete="off" spellcheck="false">
    <button class="modal-btn" id="connect-btn">Connect to Airtable →</button>
    <div class="modal-err" id="modal-err"></div>
  </div>
</div>

<!-- TOOLTIP -->
<div class="tooltip" id="tooltip">
  <div class="tt-phase" id="tt-phase"></div>
  <div class="tt-name" id="tt-name"></div>
  <div class="tt-dates" id="tt-dates"></div>
  <div class="tt-status" id="tt-status"></div>
</div>

<!-- HEADER -->
<header>
  <div class="header-left">
    <h1>2026 <span>Campaign</span> Calendar</h1>
    <div class="header-sub" id="header-sub">— connecting —</div>
  </div>
  <div class="header-legend">
    <div class="legend-item"><span class="legend-dot" style="background:var(--phase-planning)"></span>Planning</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--phase-execution)"></span>Execution</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--phase-launch)"></span>Launch</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--phase-review)"></span>Review &amp; Report</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--phase-done)"></span>Done</div>
  </div>
</header>

<!-- CONTROLS -->
<div class="controls">
  <span class="filter-label">Filter</span>
  <button class="filter-btn active" data-filter="all">All Phases</button>
  <button class="filter-btn" data-filter="Planning">Planning</button>
  <button class="filter-btn" data-filter="Execution">Execution</button>
  <button class="filter-btn" data-filter="Launch">Launch</button>
  <button class="filter-btn" data-filter="Review & Report">Review &amp; Report</button>
  <div class="spacer"></div>
  <button id="refresh-btn"><span id="status-dot"></span> Refresh</button>
</div>

<!-- MAIN -->
<main id="main">
  <div class="skeleton-msg" id="loading-msg">Fetching live data from Airtable…</div>
  <div class="scroll-wrapper" id="scroll-wrapper" style="display:none">
    <div class="timeline-inner" id="timeline-inner"></div>
  </div>
</main>

<script>
const BASE_ID = 'appeiBEuOf8zRHX96';
const TABLE   = '[MASTER] Milestones';

const PHASE_COLORS = {
  'Planning':        'var(--phase-planning)',
  'Execution':       'var(--phase-execution)',
  'Launch':          'var(--phase-launch)',
  'Review & Report': 'var(--phase-review)',
};
function phaseColor(phase) {
  return PHASE_COLORS[phase] || 'var(--muted)';
}

let API_TOKEN = '';
let allRecords = [];
let activeFilter = 'all';

// ── MODAL ────────────────────────────────────────
const overlay    = document.getElementById('modal-overlay');
const tokenInput = document.getElementById('token-input');
const connectBtn = document.getElementById('connect-btn');
const modalErr   = document.getElementById('modal-err');

// Try sessionStorage token
const savedToken = sessionStorage.getItem('at_token');
if (savedToken) { API_TOKEN = savedToken; overlay.classList.add('hidden'); init(); }

connectBtn.addEventListener('click', async () => {
  const t = tokenInput.value.trim();
  if (!t) { modalErr.textContent = 'Please paste your Airtable personal access token.'; return; }
  connectBtn.disabled = true;
  connectBtn.textContent = 'Connecting…';
  modalErr.textContent = '';
  const ok = await testToken(t);
  if (ok) {
    API_TOKEN = t;
    sessionStorage.setItem('at_token', t);
    overlay.classList.add('hidden');
    init();
  } else {
    modalErr.textContent = 'Could not connect. Check your token and try again.';
    connectBtn.disabled = false;
    connectBtn.textContent = 'Connect to Airtable →';
  }
});

tokenInput.addEventListener('keydown', e => { if (e.key === 'Enter') connectBtn.click(); });

async function testToken(token) {
  try {
    const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(TABLE)}?maxRecords=1`;
    const r = await fetch(url, { headers: { Authorization: `Bearer ${token}` } });
    return r.ok;
  } catch { return false; }
}

// ── FETCH ────────────────────────────────────────
async function fetchAll() {
  setStatus('loading');
  let records = [];
  let offset = null;
  try {
    do {
      let url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(TABLE)}?pageSize=100`;
      if (offset) url += `&offset=${offset}`;
      const r = await fetch(url, { headers: { Authorization: `Bearer ${API_TOKEN}` } });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      const data = await r.json();
      records = records.concat(data.records);
      offset = data.offset || null;
    } while (offset);
    setStatus('live');
    return records;
  } catch(e) {
    setStatus('error');
    throw e;
  }
}

function setStatus(s) {
  document.getElementById('status-dot').className = s;
}

// ── INIT ─────────────────────────────────────────
async function init() {
  try {
    allRecords = await fetchAll();
    render();
    document.getElementById('main').classList.add('visible');
  } catch(e) {
    document.getElementById('loading-msg').textContent = 'Error loading data: ' + e.message;
  }
}

document.getElementById('refresh-btn').addEventListener('click', async () => {
  if (!API_TOKEN) return;
  try {
    allRecords = await fetchAll();
    render();
  } catch(e) {}
});

// ── FILTER ───────────────────────────────────────
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.filter;
    render();
  });
});

// ── RENDER ───────────────────────────────────────
function render() {
  const filtered = activeFilter === 'all'
    ? allRecords
    : allRecords.filter(r => r.fields['Phase'] === activeFilter);

  // Group by Campaign
  const campaigns = {};
  filtered.forEach(rec => {
    const f = rec.fields;
    const camp = f['Campaign'] || 'Uncategorized';
    if (!campaigns[camp]) campaigns[camp] = [];
    campaigns[camp].push(f);
  });

  // Date range
  let minDate = Infinity, maxDate = -Infinity;
  filtered.forEach(rec => {
    const f = rec.fields;
    const s = parseDate(f['Auto Start Date'] || f['Start Date']);
    const e = parseDate(f['Auto End Date']   || f['Start Date']);
    if (s && s < minDate) minDate = s;
    if (e && e > maxDate) maxDate = e;
  });

  if (!isFinite(minDate)) {
    document.getElementById('loading-msg').textContent = 'No records match this filter.';
    document.getElementById('loading-msg').style.display = '';
    document.getElementById('scroll-wrapper').style.display = 'none';
    return;
  }

  // Pad range
  minDate = new Date(minDate); minDate.setDate(1);
  maxDate = new Date(maxDate); maxDate.setDate(1); maxDate.setMonth(maxDate.getMonth() + 2);
  minDate = minDate.getTime(); maxDate = maxDate.getTime();
  const span = maxDate - minDate;

  document.getElementById('header-sub').textContent =
    `${allRecords.length} milestones · ${Object.keys(campaigns).length} campaigns · live data`;

  // Build month list
  const months = [];
  let cur = new Date(minDate);
  while (cur.getTime() < maxDate) {
    months.push(new Date(cur));
    cur.setMonth(cur.getMonth() + 1);
  }

  function pct(ts) {
    return ((ts - minDate) / span * 100).toFixed(4) + '%';
  }

  // Render
  const inner = document.getElementById('timeline-inner');
  inner.innerHTML = '';

  // Month header
  const mh = document.createElement('div');
  mh.className = 'month-header';
  const spacer = document.createElement('div');
  spacer.className = 'month-label-spacer';
  mh.appendChild(spacer);
  const mt = document.createElement('div');
  mt.className = 'month-track';
  mt.style.position = 'relative';
  months.forEach(m => {
    const mc = document.createElement('div');
    mc.className = 'month-cell';
    mc.style.left = pct(m.getTime());
    mc.style.width = pct(new Date(m.getFullYear(), m.getMonth()+1, 1).getTime() - m.getTime());
    mc.textContent = m.toLocaleString('default', { month: 'short', year: '2-digit' });
    mt.appendChild(mc);
  });
  mh.appendChild(mt);
  inner.appendChild(mh);

  // Campaign rows
  const today = Date.now();
  Object.entries(campaigns).sort(([a],[b]) => a.localeCompare(b)).forEach(([campName, milestones]) => {
    // Group milestones by phase
    const phases = {};
    milestones.forEach(f => {
      const ph = f['Phase'] || 'Other';
      if (!phases[ph]) phases[ph] = [];
      phases[ph].push(f);
    });

    const phaseOrder = ['Planning','Execution','Launch','Review & Report'];
    const phaseKeys = [...new Set([...phaseOrder.filter(p => phases[p]), ...Object.keys(phases).filter(p => !phaseOrder.includes(p))])];

    const group = document.createElement('div');
    group.className = 'campaign-group';

    const bar = document.createElement('div');
    bar.className = 'campaign-name-bar';

    const lbl = document.createElement('div');
    lbl.className = 'campaign-label';

    const title = document.createElement('div');
    title.className = 'campaign-title';
    title.textContent = campName;

    const meta = document.createElement('div');
    meta.className = 'campaign-meta';
    const done = milestones.filter(f => f['Status'] === 'Done').length;
    meta.textContent = `${done}/${milestones.length} done`;

    lbl.appendChild(title);
    lbl.appendChild(meta);
    bar.appendChild(lbl);

    const tl = document.createElement('div');
    tl.className = 'campaign-timeline';

    phaseKeys.forEach(phase => {
      const phaseMilestones = phases[phase] || [];
      const lane = document.createElement('div');
      lane.className = 'phase-lane';
      lane.style.position = 'relative';
      lane.style.minHeight = '44px';

      // Month grid lines
      months.forEach(m => {
        const line = document.createElement('div');
        line.className = 'month-line';
        line.style.left = pct(m.getTime());
        lane.appendChild(line);
      });

      // Today line (only in first phase row)
      if (phase === phaseKeys[0] && today >= minDate && today <= maxDate) {
        const tl2 = document.createElement('div');
        tl2.className = 'today-line';
        tl2.style.left = pct(today);
        lane.appendChild(tl2);
        const tll = document.createElement('div');
        tll.className = 'today-label';
        tll.style.left = pct(today);
        tll.textContent = 'TODAY';
        lane.appendChild(tll);
      }

      // Dots
      phaseMilestones.forEach(f => {
        const startTs = parseDate(f['Auto Start Date'] || f['Start Date']);
        const endTs   = parseDate(f['Auto End Date']   || f['Start Date']);
        if (!startTs) return;

        const isDone = f['Status'] === 'Done';
        const color  = isDone ? 'var(--phase-done)' : phaseColor(phase);

        // Bar (if multi-day)
        if (endTs && endTs > startTs) {
          const barEl = document.createElement('div');
          barEl.className = 'ms-bar';
          barEl.style.left  = pct(startTs);
          barEl.style.width = pct(endTs - startTs);
          barEl.style.background = color;
          lane.appendChild(barEl);
        }

        // Dot at start
        const dot = document.createElement('div');
        dot.className = 'ms-dot' + (isDone ? ' done' : '');
        dot.style.left = pct(startTs);
        dot.style.top  = '50%';
        dot.style.background = color;
        dot.style.boxShadow  = isDone ? 'none' : `0 0 8px ${color}60`;

        // Tooltip events
        dot.addEventListener('mouseenter', e => showTooltip(e, f, phase, color));
        dot.addEventListener('mousemove',  e => moveTooltip(e));
        dot.addEventListener('mouseleave', hideTooltip);

        lane.appendChild(dot);
      });

      tl.appendChild(lane);
    });

    bar.appendChild(tl);
    group.appendChild(bar);
    inner.appendChild(group);
  });

  document.getElementById('loading-msg').style.display = 'none';
  document.getElementById('scroll-wrapper').style.display = '';
}

// ── TOOLTIP ──────────────────────────────────────
const tooltip = document.getElementById('tooltip');

function showTooltip(e, f, phase, color) {
  document.getElementById('tt-phase').textContent = phase;
  document.getElementById('tt-phase').style.color = color;
  document.getElementById('tt-name').textContent = f['Milestones'] || f['Name'] || '—';

  const s = fmtDate(f['Auto Start Date'] || f['Start Date']);
  const end = fmtDate(f['Auto End Date']);
  document.getElementById('tt-dates').textContent = end && end !== s
    ? `${s} → ${end}  (${f['Duration (Days)'] || '?'} days)`
    : s;

  const isDone = f['Status'] === 'Done';
  const statusEl = document.getElementById('tt-status');
  statusEl.innerHTML = `<span class="dot" style="background:${isDone ? 'var(--phase-done)' : color}"></span>${f['Status'] || '—'}${f['Channel'] ? ' · ' + f['Channel'] : ''}`;

  moveTooltip(e);
  tooltip.classList.add('visible');
}

function moveTooltip(e) {
  const tx = e.clientX + 14;
  const ty = e.clientY - 10;
  const tw = tooltip.offsetWidth || 260;
  const th = tooltip.offsetHeight || 120;
  tooltip.style.left = (tx + tw > window.innerWidth  ? e.clientX - tw - 14 : tx) + 'px';
  tooltip.style.top  = (ty + th > window.innerHeight ? e.clientY - th - 10 : ty) + 'px';
}

function hideTooltip() { tooltip.classList.remove('visible'); }

// ── UTILS ─────────────────────────────────────────
function parseDate(d) {
  if (!d) return null;
  const ts = Date.parse(d);
  return isNaN(ts) ? null : ts;
}

function fmtDate(d) {
  if (!d) return null;
  const dt = new Date(d);
  if (isNaN(dt)) return null;
  return dt.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}
</script>
</body>
</html>
